<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sistema de gestion Estudiantil</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .navbar-custom {
            background-color: #401a64 !important;

            .nav-link {
                color: white;
            }
        }

        main {
            h1 {
                width: 100%;
                margin: 0 20px;
            }

            .InfoCursoActividad {
                display: flex;
            }

            .cursos-container {
                margin: 20px;
                display: flex;
                flex-wrap: wrap;
                gap: 8px;


                .curso {
                    padding: 10px;
                    width: 300px;
                    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                    transition: transform 500ms ease-in-out, margin-right 200ms ease-in-out;

                }

                .curso:hover {
                    transform: scale(1.15);
                    margin-right: 0 10px 0 0;
                }
            }

            .info-buscador {
                display: grid;
                grid-template-columns: 1fr 1fr;
                place-items: center;

                #formularioMatricularEstudiante,
                #formularioCursosHandler {
                    margin-top: 20px;
                    display: grid;
                    grid-template-columns: 150px 300px;
                    place-content: center;
                    gap: 10px;

                    .btn-container {
                        display: flex;
                        justify-content: center;
                        margin: 20px;
                    }

                    .btn-custom {
                        margin: 0 16px !important;
                        padding: 8px !important;
                    }

                    .btn-limited {
                        width: auto;
                        /* Ajusta el ancho automáticamente al contenido */
                        margin: 20px auto;
                        /* Centra el botón horizontalmente */
                    }

                    .table {
                        width: 75%;
                        max-width: 90%;
                        margin: 0 auto;

                    }
                }

                .btns-Estudiantes,
                .btns-Cursos {
                    margin-top: 20px;
                }

            }

            #InfoCursoActividadContainer {
                display: none;
                justify-content: space-around;

                #cursoInfoContainer {
                    margin: 40px;

                    #info-curso {
                        display: flex;
                        flex-direction: column;
                    }
                }


                .agregarActividad {
                    margin: 40px;

                    form {
                        display: flex;
                        gap: 4px;
                    }

                }
            }

            #estudiantes-info {
                display: none;
                flex-direction: column;
                justify-content: center;
                margin: 80px;

                .agregarEStudianteForm {

                    width: 60%;


                }

            }
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary navbar-custom">
        <div class="container-fluid">
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a id="CursosVer" class="nav-link" href="#">Cursos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Estudiantes</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Log out</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Otras Opciones
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Agregar Cursos</a></li>
                            <li><a class="dropdown-item" href="#">Agregar actividad</a></li>
                            <li><a class="dropdown-item" href="#">logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <main>
        <div class="cursos-container" id="cursosContainer">
            <h1>Tus Cursos</h1>
        </div>
        <div class="InfoCursoActividad" id="InfoCursoActividadContainer">
            <div id="cursoInfoContainer">
                <div id="info-curso">

                </div>

            </div>
            <div class="agregarActividad">
                <h3>
                    <p>Agregar Una nueva Actividad a tu Curso</p>
                </h3>

                <form action="POST">
                    <label for="Actividad">Actividad:</label>
                    <input type="text" id="Actividad" placeholder="Nombre de la nueva actividad">
                    <input type="button" id="btnAgregarActividad" value="Agregar">
                </form>

            </div>
        </div>
        <div class="info-buscador">
            <div class="agregarEStudianteForm">
                <h1>Gestion de Estudiantes</h1>
                <form id="formularioMatricularEstudiante" class="row">


                    <label for="idEstudiante">codigo:</label>
                    <input type="text" id="idEstudiante" disabled>
                    <label for="correoEstudiante">correo:</label>
                    <input type="text" id="correoEstudiante">
                    <label for="NombresEstudiante">Nombres:</label>
                    <input type="text" id="NombresEstudiante">

                    <label for="ApellidosEstudiante">Apellidos:</label>
                    <input type="text" id="ApellidosEstudiante">

                    <label for="contrasenaEstudiante">contraseña:</label>
                    <input type="password" id="contrasenaEstudiante" placeholder="generar contraseña automaticamente">

                    <label for="cursoSelecionadoAlumno">Curso:</label>
                    <input type="text" id="cursoSelecionadoAlumno" disabled placeholder="Seleciona un curso">
                </form>

            </div>
            <div class="agregarCursoForm">
                <h1>Gestion de Cursos</h1>
                <form id="formularioCursosHandler" class="row">
                    <label for="codigoCurso">Codigo :</label>
                    <input type="text" id="codigoCurso" disabled>
                    <label for="nombreCurso">Nombre del curso:</label>
                    <input type="text" id="nombreCurso">

                    <label for="NombresProfesor">Profesor:</label>
                    <input type="text" id="NombresProfesor" disabled>

                    <label for="cantidadAlumno">Alumnos Inscritos:</label>
                    <input type="text" id="cantidadAlumno" disabled>

                    <label for="ComboxActividades">Tus Actividades:</label>
                    <select class="form-control" id="ComboxActividades">
                        <option value="">Selecciona una opción</option>
                    </select>
                    <label for="actividadAgregar">Agregar Actividad</label>
                    <input type="text" id="actividadAgregar" placeholder="actividad a agregar">
                </form>
            </div>
            <div class="btns-Estudiantes">
                <button type="button" id="btnAgregarAlumno" class="btn btn-secondary btn-limited btn-custom">CREAR
                    ALUMNO</button>
                <button type="button" id="btnBuscarAlumno"
                    class="btn btn-secondary btn-limited btn-custom">BUSCAR</button>
                <button type="button" id="btnMatricularAlumno"
                    class="btn btn-secondary btn-limited btn-custom">MATRICULAR</button>
                <button type="button" id="btnEliminarAlumno"
                    class="btn btn-secondary btn-limited btn-custom">ELIMINAR</button>
                <button type="button" id="btnCancelarAlumno"
                    class="btn btn-secondary btn-limited btn-custom">CANCELAR</button>
                <button type="button" id="btnLimpiarEstudiante"
                    class="btn btn-secondary btn-limited btn-custom">LIMPIAR</button>
            </div>
            <div class="btns-Cursos">
                <button type="button" id="btnAgregarCurso" class="btn btn-secondary btn-limited btn-custom">CREAR
                    CURSO</button>
                <button type="button" id="btnBuscarCurso"
                    class="btn btn-secondary btn-limited btn-custom">BUSCAR</button>
                <button type="button" id="btnEliminarCurso" class="btn btn-secondary btn-limited btn-custom">ELIMINAR
                    ACT</button>
                <button type="button" id="btnAgrearActividadCurso"
                    class="btn btn-secondary btn-limited btn-custom">AGREGAR ACT</button>
                <button type="button" id="btnLimpiarCurso"
                    class="btn btn-secondary btn-limited btn-custom">LIMPIAR</button>
            </div>
        </div>
        <div id="estudiantes-info" class="container-mt5">
            <div class="btn-container">
                <button type="button" id="btnImprimir"
                    class="btn btn-secondary btn-limited btn-custom">Imprimir</button>
            </div>

            <table class="table table-resposive table-bordered table-hover table-striped" id="tablaEStudiantes">
                <thead id="encabezado">
                    <tr id="encabezadosTablaEStudiantes" class="table-active">

                        <!-- Agrega más columnas de actividades según sea necesario -->
                    </tr>
                </thead>
                <tbody id="infoTablaEstudiantes">
                </tbody>
            </table>
        </div>
    </main>
    <script>
        //contenedores
        const cursosContainer = document.getElementById('cursosContainer');
        const infoCurso = document.getElementById('info-curso');
        const InfoCursoActividadContainer = document.getElementById('InfoCursoActividadContainer');
        const estudiantesInfo = document.getElementById('estudiantes-info');
        const tablaEStudiantes = document.getElementById('tablaEStudiantes');
        const encabezado = document.getElementById('encabezado');
        const encabezadosTablaEStudiantes = document.getElementById('encabezadosTablaEStudiantes');
        const infoTablaEstudiantes = document.getElementById('infoTablaEstudiantes');

        const btnCancelar = document.getElementById('btnCancelar');
        const btnAgregarAlumnoMenu = document.getElementById('btnAgregarAlumno');


        //Componentes  de Estudiante
        const formularioMatricularEstudiante = document.getElementById('formularioMatricularEstudiante');
        const correoEstudiante = document.getElementById('correoEstudiante');
        const idEstudiante = document.getElementById('idEstudiante');
        const NombresEstudiante = document.getElementById('NombresEstudiante');
        const ApellidosEstudiante = document.getElementById('ApellidosEstudiante');
        const contrasenaEstudiante = document.getElementById('contrasenaEstudiante');
        const cursoSelecionadoAlumno = document.getElementById('cursoSelecionadoAlumno');
        let idEstudianteCambios = null

        //btns de estudiante
        const codigoCurso = document.getElementById('codigoCurso');
        const btnAgregarAlumno = document.getElementById('btnAgregarAlumno');
        const btnBuscarAlumno = document.getElementById('btnBuscarAlumno');
        const btnEliminarAlumno = document.getElementById('btnEliminarAlumno');
        const btnCancelarAlumno = document.getElementById('btnCancelarAlumno');
        const btnLimpiarEstudiante = document.getElementById('btnLimpiarEstudiante');
        const btnMatricularAlumno = document.getElementById('btnMatricularAlumno');

        //Componentes  de Curso
        const formularioCursosHandler = document.getElementById('formularioCursosHandler');
        const nombreCurso = document.getElementById('nombreCurso');
        const NombresProfesor = document.getElementById('NombresProfesor');
        const ComboxActividades = document.getElementById('ComboxActividades');
        const actividadAgregar = document.getElementById('actividadAgregar');
        const cantidadAlumno = document.getElementById('cantidadAlumno');
        let idCursoCambios = null

        //btns de curso
        const btnAgregarCurso = document.getElementById('btnAgregarCurso');
        const btnBuscarCurso = document.getElementById('btnBuscarCurso');
        const btnEliminarCurso = document.getElementById('btnEliminarCurso');
        const btnAgrearActividadCurso = document.getElementById('btnAgrearActividadCurso');
        const btnLimpiarCurso = document.getElementById('btnLimpiarCurso');

        //navegacio
        const CursosVer = document.getElementById('CursosVer')
        const btnImprimir = document.getElementById('btnImprimir')
        const URLBASE = 'http://localhost:3000'

        //infoProfe
        let idProfe;
        let nombreProfe;

        const accessToken = localStorage.getItem("accessToken");
        const refreshToken = localStorage.getItem("refreshToken");

        const btnAgregarActividad = document.getElementById('btnAgregarActividad');
        let cursoSelecionado;
        let actividadEnvio;

        document.addEventListener('DOMContentLoaded', async () => {
            //TRAER DATOS DEL PROFESOR

            const infoProfe = await buscarInfoProfe()
            if (infoProfe) {
                idProfe = infoProfe._id
                nombreProfe = `${infoProfe.nombres} ${infoProfe.apellidos}`
            }
            else {
                alert("no tiene permiso")
            }
            // TRAER DATOS DE TODOS LOS CURSOS DEL PROFESOR

            const dataCursos = await buscarCursos();
            if (dataCursos && dataCursos != null) {
                await manipularCursos(dataCursos)
            } else {
                alert("no hay cursos")
            }


        });

        btnAgregarActividad.addEventListener('click', async (e) => {
            e.preventDefault(); // Evita el envío del formulario
            // Realiza la petición para agregar la actividad
            const response = await fetch(`http://localhost:3000/api/public/curso/${idCursoCambios}/actividad`, {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json',
                    'AccessToken': accessToken,
                    'RefreshToken': refreshToken
                },
                body: JSON.stringify({ actividad: actividadAgregar.value })
            });

            if (response.ok) {
                window.location.reload();
            } else {
                // Mostrar un mensaje de error si la solicitud no fue exitosa
                alert("No se pudo agregar la actividad.");
            }
        });

        btnAgregarAlumnoMenu.addEventListener('click', async (e) => {
            e.preventDefault();
            hacerVisible(formularioMatricularEstudiante, 'grid')
        });

        //registra un alumno a la base de datos
        btnAgregarAlumno.addEventListener('click', async (e) => {
            e.preventDefault();

            const response = await fetch(`http://localhost:3000/api/public/registro`, {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json',
                    'AccessToken': accessToken,
                    'RefreshToken': refreshToken
                },
                body: JSON.stringify({
                    "nombres": NombresEstudiante.value,
                    "apellidos": ApellidosEstudiante.value,
                    "correo": correoEstudiante.value,
                    "contrasena": "12345",
                    "role": "estudiante"

                })
            });

            if (response.ok) {
                // Recargar la página si la actividad se agregó correctamente
                window.location.reload();
            } else {
                // Mostrar un mensaje de error si la solicitud no fue exitosa
                alert("No se pudo agregar al estudiante.");
            }



        })

        //consulta un alumno a la base de datos
        btnBuscarAlumno.addEventListener('click', async (e) => {
            console.log("buscando");
            console.log(correoEstudiante.value);
            try {
                const response = await fetch(`http://localhost:3000/api/public/usuarios/${correoEstudiante.value}`, {
                    method: "GET",
                    headers: {
                        'Content-Type': 'application/json',
                        'AccessToken': accessToken,
                        'RefreshToken': refreshToken
                    }
                });

                if (response.ok) {
                    const data = await response.json()
                    idEstudiante.value = data._id
                    NombresEstudiante.value = data.nombres
                    ApellidosEstudiante.value = data.apellidos
                    contrasenaEstudiante.setAttribute('disabled', true)

                    idEstudianteCambios = data._id
                } else {
                    // Mostrar un mensaje de error si la solicitud no fue exitosa
                    alert("No se encontro al estudiante.");
                }
            } catch (error) {

            }



        })

        //Limpiar compoenentes de alumno
        btnLimpiarEstudiante.addEventListener('click', (e) => {
            e.preventDefault()
            correoEstudiante.value = ''
            NombresEstudiante.value = ''
            ApellidosEstudiante.value = ''
            contrasenaEstudiante.value = ''
            cursoSelecionadoAlumno.value = ''
        })
        //matricular alumno

        btnMatricularAlumno.addEventListener('click', async (e) => {
            console.log("matriculando");
            try {
                const response = await fetch(`http://localhost:3000/api/public/curso/${idCursoCambios}/matricular`, {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json',
                        'AccessToken': accessToken,
                        'RefreshToken': refreshToken
                    },
                    body: JSON.stringify({ idEstudiante: idEstudianteCambios })
                });
                console.log(response.status);
                if (response.ok) {
                    const data = await response.json()
                    correoEstudiante.value = ''
                    NombresEstudiante.value = ''
                    ApellidosEstudiante.value = ''
                    contrasenaEstudiante.value = ''

                    idEstudianteCambios = ''
                    window.location.reload()
                } else {
                    // Mostrar un mensaje de error si la solicitud no fue exitosa
                    alert("No se encontro al estudiante.");
                }
            } catch (error) {

            }

        })
        //ELIMINAR alumno

        btnEliminarAlumno.addEventListener('click', async (e) => {
            try {
                const response = await fetch(`http://localhost:3000/api/public/curso/${idCursoCambios}/eliminarEstudiante`, {
                    method: "DELETE",
                    headers: {
                        'Content-Type': 'application/json',
                        'AccessToken': accessToken,
                        'RefreshToken': refreshToken
                    },
                    body: JSON.stringify({ idEstudiante: idEstudiante.value })
                });
                if (response.ok) {
                    const data = await response.json()
                    idEstudiante.value = ''
                    correoEstudiante.value = ''
                    NombresEstudiante.value = ''
                    ApellidosEstudiante.value = ''
                    contrasenaEstudiante.value = ''

                    idEstudianteCambios = ''
                    alert("has eliminado al estudiante de tu curso")
                    window.location.reload()
                } else {

                    // Mostrar un mensaje de error si la solicitud no fue exitosa
                    alert("No se encontro al estudiante.");
                }
                console.log(response);
            } catch (error) {

            }

        })
        ComboxActividades.addEventListener('change', (e) => {

        })

        btnCancelarAlumno.addEventListener('click', () => {
            hacerVisible(cursosContainer, "flex")
        })

        btnAgregarCurso.addEventListener('click', async (e) => {
            console.log("agregando curso");
            console.log(nombreCurso);
            try {
                const response = await fetch(`http://localhost:3000/api/public/curso/crear`, {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json',
                        'AccessToken': accessToken,
                        'RefreshToken': refreshToken
                    },
                    body: JSON.stringify({ nombre: nombreCurso.value })
                });
                console.log(response.status);
                if (response.ok) {
                    const data = await response.json()
                    nombreCurso.value = ''
                    codigoCurso.value = ''
                    ComboxActividades.value = ''
                    actividadAgregar.value = ''

                    window.location.reload()
                } else {
                    // Mostrar un mensaje de error si la solicitud no fue exitosa
                    alert("No se encontro al estudiante.");
                }
            } catch (error) {

            }

        })
        btnEliminarCurso.addEventListener('click', async (e) => {
            console.log("eliminando curso");
            const index = ComboxActividades.selectedIndex
            const actividad = (ComboxActividades[index].text);
            try {
                const response = await fetch(`http://localhost:3000/api/public/curso/${idCursoCambios}/actividad`, {
                    method: "DELETE",
                    headers: {
                        'Content-Type': 'application/json',
                        'AccessToken': accessToken,
                        'RefreshToken': refreshToken
                    },
                    body: JSON.stringify({ actividad: actividad })
                });
                console.log(response.status);
                if (response.ok) {
                    const data = await response.json()
                    nombreCurso.value = ''
                    codigoCurso.value = ''
                    ComboxActividades.value = ''
                    actividadAgregar.value = ''

                    window.location.reload()
                } else {
                    // Mostrar un mensaje de error si la solicitud no fue exitosa
                    alert("No se encontro al estudiante.");
                }
            } catch (error) {

            }

        })

        btnAgrearActividadCurso.addEventListener('click', async (e) => {
            e.preventDefault(); // Evita el envío del formulario
            console.log("agregando actividad");
            try {
                const response = await fetch(`http://localhost:3000/api/public/curso/${idCursoCambios}/actividad`, {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json',
                        'AccessToken': accessToken,
                        'RefreshToken': refreshToken
                    },
                    body: JSON.stringify({ actividad: actividadAgregar.value })
                });

                if (response.ok) {
                    // Recargar la página si la actividad se agregó correctamente
                    window.location.reload();
                } else {
                    // Mostrar un mensaje de error si la solicitud no fue exitosa
                    alert("No se pudo agregar la actividad.");
                }
            } catch (error) {

            }

        })

        btnLimpiarCurso.addEventListener('click', (e) => {
            console.log("limpiando cursoso");
            nombreCurso.value = ''
            actividadAgregar.value = ''
            cantidadAlumno.value = ''
            codigoCurso.value = ''
            idCursoCambios = null
        })

        btnBuscarCurso.addEventListener('click', async (e) => {
            e.preventDefault(); // Evita el envío del formulario
            console.log("buscando");
            try {
                const response = await fetch(`http://localhost:3000/api/public/curso/nombre/${nombreCurso.value}`, {
                    method: "GET",
                    headers: {
                        'Content-Type': 'application/json',
                        'AccessToken': accessToken,
                        'RefreshToken': refreshToken
                    }
                });

                if (response.ok) {
                    const data = await response.json()
                    setearInfoCurso(data._id, data.nombre, nombreProfe, data.estudiantes.length, data.actividades.actividadesEStablecidas)
                    cursoSelecionadoAlumno.value = data.nombre
                } else {
                    // Mostrar un mensaje de error si la solicitud no fue exitosa
                    alert("No se pudo encontro la actividad.");
                }
            } catch (error) {

            }

        })
        const CambioDeNota = async (idEstudiante, actividad, nota) => {
            console.log("cambiando Nota");


        }

        const hacerVisible = (element, display) => {
            element.style.display = display
        }
        const hacerInvisible = (element) => {
            element.style.display = 'none'
        }

        const buscarInfoProfe = async () => {
            try {
                const response = await fetch(`http://localhost:3000/api/public/usuariobyToken`, {
                    method: "GET",
                    headers: {
                        'Content-Type': 'application/json',
                        'AccessToken': accessToken,
                        'RefreshToken': refreshToken
                    }
                });

                if (response.ok) {
                    const profe = await response.json()
                    return profe;
                } else {
                    // Mostrar un mensaje de error si la solicitud no fue exitosa
                    alert("No se encontro al estudiante.");
                }
            } catch (error) {

            }
        }
        const buscarCursos = async () => {

            try {
                const response = await fetch(`http://localhost:3000/api/public/mis-cursos`, {
                    method: "GET",
                    headers: {
                        'Content-Type': 'application/json',
                        'AccessToken': accessToken,
                        'RefreshToken': refreshToken
                    }
                });

                if (response.ok) {
                    const cursosData = await response.json()

                    return cursosData;
                } else {
                    // Mostrar un mensaje de error si la solicitud no fue exitosa
                    alert("No se encontro el curso.");
                }
            } catch (error) {

            }
        }

        const manipularCursos = (cursosData) => {
            cursosData.forEach(curso => {
                const cursoElement = document.createElement('div');
                cursoElement.classList.add('curso');
                cursoElement.innerHTML = `
                    <p class="curso-nombre">Curso: ${curso.nombre}</p>
                    <p class="curso-profesor">Profesor: ${curso.profesor}</p>
                    <p class="curso-estudiantes-num">Alumnos inscriptos: ${curso.alumnos}</p>
                    <p class="curso-estudiantes-num">Código: ${curso.id}</p>
                `;


                cursosContainer.appendChild(cursoElement);

                // INFO DEL CURSO CLICKEADO
                selecionarCurso(cursoElement, curso)
            });
        }
        const selecionarCurso = (cursoElement, curso) => {
            cursoElement.addEventListener('click', async () => {

                hacerInvisible(cursosContainer)
                setearInfoCurso(curso.id, curso.nombre, curso.profesor, curso.alumnos, curso.actividades)

                idCursoCambios = curso.id;


                const dataCurso = await peticion(`http://localhost:3000/api/public/curso/${curso.id}`, {
                    'Content-Type': 'application/json',
                    'AccessToken': accessToken,
                    'RefreshToken': refreshToken
                }, {}, 'GET');

                cursoSelecionadoAlumno.value = dataCurso.nombre


                let actividadesHTML = '';


                infoCurso.innerHTML = `
                    <h2>Información del Curso</h2>
                    <p class="curso-nombre">Curso: ${dataCurso.nombre}</p>
                    <p class="curso-profesor">Profesor: ${dataCurso.profesor}</p>
                    <p class="curso-profesor">Actividades: ${dataCurso.actividades.actividadesEStablecidas.join(",")}</p>
                    <p class="curso-estudiantes-num">Alumnos inscriptos: ${dataCurso.estudiantes.length}</p>
                `;

                estudiantesInfo.style.display = 'flex';

                // Crear tabla dinámicamente
                encabezadosTablaEStudiantes.innerHTML = "";
                let theadPararReporte = ''
                let tbodyParaReporte = ''

                // Crear encabezados
                let listaDeEncabezados = ['#', 'Nombres', 'Apellidos'];
                const actividadesEvaluadas = dataCurso.actividades.actividadesEStablecidas;
                listaDeEncabezados = listaDeEncabezados.concat(actividadesEvaluadas);

                //lista de encabezados para reporte
                listaDeEncabezados.forEach(encabezado => {
                    theadPararReporte += `<th scope="col" class="col-2">${encabezado}</th>`;
                });
                //lista de encabezados para tabla pagina
                listaDeEncabezados.push("modificar")
                listaDeEncabezados.forEach(encabezado => {
                    const th = document.createElement('th');
                    th.innerHTML = `<th scope="col" class="col-2">${encabezado}</th>`;
                    encabezadosTablaEStudiantes.appendChild(th);
                });
                encabezado.appendChild(encabezadosTablaEStudiantes);
                tablaEStudiantes.appendChild(encabezado);

                infoTablaEstudiantes.innerHTML = ""
                const estudiantes = dataCurso.estudiantes;

                //se guardara todas la informacion del cuerpo de l tabala para luego anexarla
                let tablasEstudianteTotal = '';
                estudiantes.forEach((e, index) => {
                    const actividadesEstudiante = e.actividadesAsignadas;
                    let notas = '';
                    actividadesEstudiante.forEach(act => {
                        notas += `<td class="col-2"><input type="Number" class="form-control nota" value="${act.nota}"></td>`;
                    });

                    tablasEstudianteTotal += `
                        <tr class="infoEstudiantesRender">
                            <td class="col-2">#${index + 1}</td>
                            <td class="col-2">${e.nombres}</td>
                            <td class="col-2">${e.apellidos}</td>
                            ${notas}
                            <td class="col-2"><button type="button" class="btn btn-custom btn-limited" id="btn-modificarNota${index + 1}">Modificar</button></td>
                        </tr>
                    `;
                    tbodyParaReporte += `
                        <tr class="infoEstudiantesRender">
                            <td class="col-2">#${index + 1}</td>
                            <td class="col-2">${e.nombres}</td>
                            <td class="col-2">${e.apellidos}</td>
                            ${notas}
                        </tr>
                    `;
                });

                //info para reporte


                btnImprimir.addEventListener('click', async () => {


                    try {
                        const response = await fetch(`http://localhost:3000/api/public/generarReporte`, {
                            method: "POST",
                            headers: {
                                'Content-Type': 'application/json',
                                'AccessToken': accessToken,
                                'RefreshToken': refreshToken
                            },
                            body: JSON.stringify({
                                encabezados: theadPararReporte,
                                cuerpo: tbodyParaReporte,
                                nombreProfe: nombreProfe,
                                nombreCurso: curso.nombre,
                            })
                        });

                        if (response.ok) {
                            // Convertir la respuesta en un Blob (objeto binario)
                            const blob = await response.blob();

                            // Crear un enlace (link) para descargar el PDF
                            const url = window.URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.style.display = 'none';
                            a.href = url;
                            a.download = 'reporte.pdf'; // Nombre del archivo para descargar
                            document.body.appendChild(a);
                            a.click();
                            window.URL.revokeObjectURL(url);
                            alert("reporte generado")
                        } else {
                            // Mostrar un mensaje de error si la solicitud no fue exitosa
                            alert("No se pudo realizar el reporte");
                        }
                    } catch (error) {
                        console.log(error);
                    }


                })

                infoTablaEstudiantes.innerHTML = tablasEstudianteTotal;

                estudiantes.forEach((e, index) => {
                    const btn = document.getElementById(`btn-modificarNota${index + 1}`);
                    btn.addEventListener('click', () => {
                        console.log("cambiando");
                        const columnaInfo = infoTablaEstudiantes.querySelectorAll('.infoEstudiantesRender')[index]
                        const inpustNotaNodo = columnaInfo.querySelectorAll('.nota')
                        let inputs = [];
                        inpustNotaNodo.forEach(e => inputs.push(e))

                        let advertenciaErrorCambioDeNota = "";
                        inputs.forEach(async (notaInput, index) => {
                            const nota = parseFloat(notaInput.value)
                            if (nota === '') {
                                alert("la nota no pude estar vacia")
                                return
                            } else if (nota > 10.00 || nota < 0.00) {
                                alert(`la nota ${actividadesEvaluadas[index]} tienen un rango inaxeptable`)
                                return

                            }
                            try {

                                console.log(`${URLBASE}/api/public/curso/${idCursoCambios}/notas/cambios`);
                                const response = await fetch(`http://localhost:3000/api/public/curso/${idCursoCambios}/notas/cambios`, {
                                    method: "PUT",
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'AccessToken': accessToken,
                                        'RefreshToken': refreshToken
                                    },
                                    body: JSON.stringify({
                                        idEstudiante: e._id,
                                        actividad: actividadesEvaluadas[index],
                                        nota: nota,
                                    })
                                });

                                if (response.ok) {
                                    console.log(await response.json());
                                } else {
                                    // Mostrar un mensaje de error si la solicitud no fue exitosa
                                    alert("No se pudo encontro la actividad.");
                                    return false
                                }
                            } catch (error) {
                                console.log(error);
                            }

                        })
                        window.location.reload()

                    });
                });
            });
        }




        const setearInfoCurso = (id, nombre, profesor, cantidadAlumnos, cursoActividades) => {
            //setemos infor en cursos
            codigoCurso.value = id
            nombreCurso.value = nombre
            NombresProfesor.value = profesor
            cantidadAlumno.value = cantidadAlumnos


            //seteamos las option a la combo box
            if (cursoActividades.length > 0) {
                let opciones = `<option value="">Selecciona una opción</option>
                    `
                cursoActividades.forEach(a => {
                    opciones += `<option value="">${a}</option>
                    `
                })

                ComboxActividades.innerHTML = opciones
            }

            idCursoCambios = id;
        }
        const peticion = async (url, headers, body, type) => {
            let response;
            try {
                const options = {
                    method: type,
                    headers: headers,
                };

                if (type !== 'GET') {
                    options.body = JSON.stringify(body); // Convertir el cuerpo a JSON
                }

                response = await fetch(url, options);

                if (!response.ok) {
                    throw new Error('Error en la respuesta del servidor');
                }

                const data = await response.json();
                return data;

            } catch (error) {
                console.error('Error al realizar la petición:', error);
                alert('Error al realizar la petición');
            }
        };
        const valorSElectedACtividades = () => { }
        CursosVer.addEventListener('click', (e) => {
            e.preventDefault()
            hacerVisible(cursosContainer, 'flex')

        })

        const generarREporteByApi = (encabezados, cuerpo) => {
            console.log(encabezados);
            console.log(cuerpo);
        }

    </script>


</body>

</html>